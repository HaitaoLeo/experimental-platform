machine:
  services:
    - docker

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  override:
    - npm install -g mustache
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - ./build.sh

test:
  override:
    - "echo 'TODO: Insert some tests here!'"
    # TODO: trigger all integration tests & wait for success!

deployment:
  release:
    branch: /.*/
    commands:
      - git submodule update --init --force
      - DEPLOY=yes ./build.sh

notify:
  webhooks:
    - url: $WEBHOOK_URL
